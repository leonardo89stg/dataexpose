<?php
function parseDesktopFile($file) {
    $data = [];

    if (file_exists($file)) {
        $lines = file($file);

        foreach ($lines as $line) {
            $line = trim($line);

            // Ignorar comentários e linhas em branco
            if (empty($line) || $line[0] === '#') {
                continue;
            }

            // Separar a linha em chave e valor
            if (strpos($line, '=') !== false) {
                list($key, $value) = explode('=', $line, 2);
                $data[$key] = $value;
            }
        }
    }

    return $data;
}

// Caminho para o diretório onde estão os arquivos .desktop
$directory = '/usr/share/applications/'; // Altere para ~/.local/share/applications/ se desejar

// Ler todos os arquivos .desktop do diretório
$files = glob($directory . '*.desktop');

?>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplicativos</title>
    <style>
        .app-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .app-item {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
            width: 150px;
        }
        .app-item img {
            max-width: 100px;
            max-height: 100px;
            display: block;
            margin: 0 auto;
        }
        .app-item p {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>Aplicativos Instalados</h1>
    <div class="app-container">
        <?php
        foreach ($files as $file) {
            $info = parseDesktopFile($file);
            $name = htmlspecialchars($info['Name'] ?? basename($file));
            $icon = htmlspecialchars($info['Icon'] ?? '');

            // Verificar se o ícone é um caminho relativo ou absoluto
            if ($icon && !preg_match('/^http/', $icon)) {
                // Caminho absoluto pode ser necessário para arquivos locais
                $iconPath = file_exists($icon) ? $icon : '';
                $iconURL = file_exists($iconPath) ? 'file://' . $iconPath : '';
            } else {
                $iconURL = $icon;
            }

            echo "<div class='app-item'>";
            if ($iconURL) {
                echo "<img src='" . htmlspecialchars($iconURL) . "' alt='Ícone'>";
            }
            echo "<p><strong>Nome:</strong> " . $name . "</p>";
            echo "</div>";
        }
        ?>
    </div>
</body>
</html>
